AWSTemplateFormatVersion: '2010-09-09'
Parameters:
  DeploymentName:
    Type: String
    Description: 'Name of deployment. Used as tag for all resources.'
Resources:
  ECRAndPolicy:
    Type: 'AWS::CloudFormation::Stack'
    Properties:
      TemplateURL: 'ecr-and-policies.yaml'
      Parameters:
        DeploymentName: !Ref DeploymentName
  S3AndPolicy:
    Type: 'AWS::CloudFormation::Stack'
    Properties:
      TemplateURL: 's3-bucket-and-policies.yaml'
      Parameters:
        DeploymentName: !Ref DeploymentName
  Roles:
    Type: 'AWS::CloudFormation::Stack'
    Properties:
      TemplateURL: 'iam-roles.ymal'
      Parameters:
        DeploymentName: !Ref DeploymentName
        ECRReadWritePolicy:
          Fn::GetAtt:
            - ECRAndPolicy
            - Outputs.ECRReadWritePolicy
        S3ReadWritePolicy:
          Fn::GetAtt:
            - S3AndPolicy
            - Outputs.S3ReadWritePolicy
  Networking:
    Type: 'AWS::CloudFormation::Stack'
    Properties:
      TemplateURL: 'networking.yaml'
      Parameters:
        DeploymentName: !Ref DeploymentName
